/* * Copyright (C) 2015 The CloudKit Open Source Project * * Licensed under the Apache License, Version 2.0 (the "License"); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * *      http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. *//* 包含相关的头文件 */#include <stdio.h>#include <stdlib.h>#include <netinet/in.h>#include <arpa/inet.h>#include <unistd.h>#include <fcntl.h>#include <sys/stat.h>#include <sys/types.h>#include <sys/socket.h>#include <strings.h>#include <string.h>/* 定义远程端口 */#define SERV_PORT 4567/* 定义远程IP */#define SERV_IP "127.0.0.1"// TCP clientint main(int argc, char *argv[]) {    /* 定义相关变量 */    int server_sockfd, client_sockfd;    /* 服务器端网络地址结构体 */    struct sockaddr_in server_addr;    /* 数据传送的缓冲区 */    char my_buffer[BUFSIZ];    /* 数据初始化清零 */    memset(&server_addr, 0, sizeof(server_addr));    /* 新建一个socket，创建客户端套接字 IPv4协议，面向连接通信，TCP协议 */    if ((server_sockfd = socket(AF_INET, SOCK_STREAM, 0)) < 0) {        perror("socket");        // exit(1);        return 1;    } else {        printf("socket created.\n");        printf("socked id: %d\n", server_sockfd);    }    /* 设置server_addr */    bzero(&server_addr, sizeof(server_addr));    /* 设置为IP通信 */    server_addr.sin_family = AF_INET;    /* 服务器IP地址 */    server_addr.sin_addr.s_addr = inet_addr(SERV_IP);    // 服务器端口号    server_addr.sin_port = htons(SERV_PORT);    /* 连接远程服务器，将套接字绑定到服务器的网络地址上 */    if (connect(server_sockfd, (struct sockaddr*)&server_addr, sizeof(server_addr)) < 0) {        perror("connect");        // exit(1);        return 1;    } else {        printf("connected ok!\n");        printf("remote ip:%s\n", SERV_IP);        printf("remote port:%d\n", SERV_PORT);    }    /* 接收服务器发送的信息 */    // recv(server_sockfd, my_buffer, sizeof(my_buffer), 0);    read(server_sockfd, my_buffer, BUFSIZ);    /* 输出信息 */    printf("%s\n", my_buffer);    /* 进入一个循环，循环的发送接收信息并打印接收信息 recv返回接收到的字节数，send返回发送的字节数 */    while (1) {        /* 清空my_buffer字符串 */        bzero(my_buffer, BUFSIZ);        printf("Enter string to send:");        /* 读取输入 sizeof(my_buffer) */        // scanf("%s", my_buffer);        read(STDIN_FILENO, my_buffer, BUFSIZ);        /*        if(!strcmp(my_buffer, "quit")) {            // break;            exit(1);        }        */        /* 发送信息 */        if (send(server_sockfd, my_buffer, strlen(my_buffer), 0) < 0) {            /* 错误处理 */            perror("send");            exit(1);        } else {            /* 清空my_buffer内存 */            bzero(my_buffer, BUFSIZ);            /* 接收服务器端信息 */            // recv(server_sockfd, my_buffer, sizeof(my_buffer), 0);            read(server_sockfd, my_buffer, BUFSIZ);            /* 打印输出服务器端信息*/            printf("received:%s\n", my_buffer);        }    }    // 关闭套接字    close(server_sockfd);    return 0;}